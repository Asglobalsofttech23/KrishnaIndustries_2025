import{r as l,j as e,G as n,a4 as h,a5 as j,h as m,c as $,d as B,ab as Fe,B as Ee,F as Ye,a7 as Ne,X as Re,Y as Me,Z as Ue,$ as Ae,a0 as ee,a1 as d,a2 as Oe,S as Ie,a6 as $e,a9 as Be,U as T,W as F,a3 as E,as as ze,V as Ve}from"./index-DFpI35T6.js";import{h as S}from"./moment-G82_0lEo.js";import{T as qe,a as se,U as Qe}from"./UpdateFlwLeads-BtYv_8Dd.js";import{C as Ge}from"./ConvertCustomer-NReCJ68I.js";import{P as He}from"./Pagination-WAac2fOa.js";const Xe=({onClose:Y,data:a})=>{const[i,z]=l.useState({leads_name:a?a.leads_name:"",leads_mobile:a?a.leads_mobile:"",leads_email:a?a.leads_email:"",leads_company:a?a.leads_company:"",leads_address:a?a.leads_address:"",leads_state:a?a.leads_state:"",leads_city:a?a.leads_city:"",product_name:a?a.product_name:"",Call_Discussion:a?a.Call_Discussion:"",remember:a?a.remember:"",reminder_date:a?a.reminder_date:""}),[f,N]=l.useState({Call_Discussion:"",remember:"",reminder_date:""}),D=(p,u)=>{let o="";const x=u&&typeof u=="string"?u.trim():u;switch(p){case"Call_Discussion":x||(o="Leads Query Message is Required");break;case"remember":x?x==="yes"&&!i.reminder_date&&(o="Reminder Date is Required"):o="Please Select one";break}return o},c=p=>{const{name:u,value:o}=p.target,x=D(u,o);z({...i,[u]:o}),N({...f,[u]:x})},b=p=>{p.preventDefault();let u={};Object.keys(i).forEach(o=>{const x=i[o],v=D(o,x);v&&(u[o]=v)}),Object.keys(u).length>0&&N(u),$.put(`${B.apiUrl}/leads/updateFlwLeadForEmp/${a.follow_id}`,i).then(o=>{console.log("Data Added Successfully.",o),Y()}).catch(o=>{console.log("Data is not added",o)})};return e.jsx("div",{children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_name",label:"Lead Name",value:i.leads_name,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_mobile",label:"Lead Mobile",value:i.leads_mobile,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_email",label:"Lead Email",value:i.leads_email,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_company",label:"Lead Company",value:i.leads_company,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_address",label:"Lead Address",value:i.leads_address,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_state",label:"Lead State",value:i.leads_state,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"leads_city",label:"Lead City",value:i.leads_city,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"product_name",label:"Product Name",value:i.product_name,onChange:c})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"Call_Discussion",label:"Leads Query",value:i.Call_Discussion,onChange:c,error:!!f.Call_Discussion,helperText:f.Call_Discussion})}),e.jsx(n,{item:!0,xs:6,children:e.jsxs(h,{fullWidth:!0,select:!0,name:"remember",label:"Remember",value:i.remember,onChange:c,error:!!f.remember,helperText:f.remember,children:[e.jsx(j,{value:"Yes",children:"Yes"}),e.jsx(j,{value:"No",children:"No"})]})}),i.remember==="Yes"&&e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,name:"reminder_date",label:"Reminder Date",type:"date",value:i.reminder_date,onChange:c,error:!!f.reminder_date,helperText:f.reminder_date,InputLabelProps:{shrink:!0}})}),e.jsx(n,{item:!0,xs:12,display:"flex",justifyContent:"center",children:e.jsx(m,{onClick:b,children:"Submit"})})]})})},ns=()=>{const Y=Fe(),[a,i]=l.useState([]),[z,f]=l.useState(null),[N,D]=l.useState(null),[c,b]=l.useState([]),[p,u]=l.useState(5),[o,x]=l.useState(1),[v,te]=l.useState([]),[ae,V]=l.useState([]),[_,q]=l.useState(""),[w,Q]=l.useState(""),[y,G]=l.useState(""),le=sessionStorage.getItem("emp_id"),[L,ne]=l.useState(1),[H,k]=l.useState(!1),[X,W]=l.useState(!1),[Z,Ze]=l.useState([]),[re,J]=l.useState([]),[ie,R]=l.useState(!1),[de,Je]=l.useState([]),[oe,M]=l.useState(!1),[ce,Ke]=l.useState([]),[ue,P]=l.useState(!1),[he,U]=l.useState(""),[xe,A]=l.useState("success"),[O,me]=l.useState(""),[I,pe]=l.useState("");l.useEffect(()=>{$.get(`${B.apiUrl}/leads/followingLeadsByEmpId?emp_id=${le}`).then(s=>{const t=new Set(s.data.map(r=>r.leads_state));te([...t]),i(s.data),b(s.data)}).catch(s=>{console.log("Leads data is not fetched.",s)})},[H,Z,X]),l.useEffect(()=>{if(_){const s=new Set(a.filter(t=>t.leads_state===_).map(t=>t.leads_city));V([...s])}else V([])},[_]),l.useEffect(()=>{const s=S().format("YYYY-MM-DD"),t=a.filter(r=>{const g=y===""||r.leads_name&&r.leads_name.toLowerCase().includes(y.toLowerCase())||r.leads_email&&r.leads_email.toLowerCase().includes(y.toLowerCase())||r.leads_mobile&&r.leads_mobile.includes(y),C=_===""||r.leads_state===_,Pe=w===""||r.leads_city===w,Te=L===1||L===2&&S(r.created_at).format("YYYY-MM-DD")===s;return g&&C&&Pe&&Te});b(t)},[y,_,w,L,a]);const je=s=>{const t=parseInt(s.target.value,10);t==1?(u(a.length),x(1)):(u(t),x(1))},fe=(o-1)*p,ge=o*p,_e=c?c.slice(fe,ge):[],Ce=()=>{q(""),Q(""),G(""),b(a)},be=s=>{const t=a.find(r=>r.follow_id===s);t&&(J(t),k(!0))},ye=s=>{J(""),W(!0)},Se=()=>{f(null),D(null)},De=(s,t)=>{Se(),Y(`/${s}/${t}`)},K=()=>{P(!1)},ve=()=>{W(!1),A("success"),U(" New Lead created successfully"),P(!0)},we=async s=>{try{if((await $.delete(`${B.apiUrl}/leads/deleteFollowingLead/${s}`)).status===200){const r=a.filter(C=>C.follow_id!==s),g=c.filter(C=>C.follow_id!==s);i(r),b(g),A("success"),U("Lead removed successfully!"),P(!0)}}catch(t){console.error("Error deleting lead:",t),A("error"),U("Failed to delete lead."),P(!0)}},Le=()=>a.filter(t=>{if(O&&I){const r=S(t.created_at).format("YYYY-MM-DD");return r>=O&&r<=I}return!0}),ke=()=>{const s=Le(),t=We(s),r=new Blob([t],{type:"text/csv"}),g=document.createElement("a");g.href=URL.createObjectURL(r),g.download="filtered_data.csv",g.click()},We=s=>{const t=["follow_id","emp_id","emp_name","leads_id","leads_name","leads_mobile","leads_email","product_name","leads_company","Description","Call_Discussion","remember","reminder_date","leads_address","leads_state","leads_city","call_Attended","gst_number","created_at"],r=s.map(g=>t.map(C=>g[C]||"").join(","));return`${t.join(",")}
${r.join(`
`)}`};return e.jsxs("div",{style:{padding:"10px"},children:[e.jsx("h1",{className:"text-center",children:"Followed Leads Index"}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:8,children:e.jsx(Ee,{sx:{width:"100%",bgcolor:"background.paper"},children:e.jsxs(qe,{value:L,onChange:(s,t)=>ne(t),centered:!0,children:[e.jsx(se,{label:"All Leads",value:1}),e.jsx(se,{label:"Today's Leads",value:2})]})})}),e.jsx(n,{item:!0,xs:4,display:"flex",justifyContent:"end",children:e.jsx(m,{variant:"outlined",onClick:Ce,children:"Cancel Filters"})})]}),e.jsx(m,{onClick:()=>ye(),children:"New walking leads"}),e.jsxs(n,{container:!0,spacing:3,style:{marginTop:"20px"},children:[e.jsx(n,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,label:"Search",placeholder:"Search by name, email, or mobile",onChange:s=>G(s.target.value),value:y})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(Ye,{fullWidth:!0,children:e.jsxs(Ne,{value:p,onChange:je,children:[e.jsx(j,{value:5,children:"5 Per Page"}),e.jsx(j,{value:10,children:"10 Per Page"}),e.jsx(j,{value:15,children:"15 Per Page"}),e.jsx(j,{value:1,children:"All Per Page"})]})})})]}),e.jsxs(n,{container:!0,spacing:3,style:{marginTop:"20px"},children:[e.jsx(n,{item:!0,xs:6,children:e.jsxs(h,{fullWidth:!0,select:!0,label:"Select State",value:_,onChange:s=>q(s.target.value),children:[e.jsx(j,{value:"",children:"All States"}),v.map((s,t)=>e.jsx(j,{value:s,children:s},t))]})}),e.jsx(n,{item:!0,xs:6,children:e.jsxs(h,{fullWidth:!0,select:!0,label:"Select City",value:w,onChange:s=>Q(s.target.value),disabled:!_,children:[e.jsx(j,{value:"",children:"All Cities"}),ae.map((s,t)=>e.jsx(j,{value:s,children:s},t))]})})]}),e.jsxs("div",{style:{padding:"20px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#f9f9f9"},children:[e.jsx("h3",{style:{textAlign:"center",padding:"10px",color:"red"},children:" Daily Reports Download"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginBottom:"15px",justifyContent:"center"},children:[e.jsx("label",{style:{fontWeight:"bold",fontSize:"14px"},children:"Start Date:"}),e.jsx("input",{type:"date",value:O,onChange:s=>me(s.target.value),style:{padding:"8px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px"}}),e.jsx("label",{style:{fontWeight:"bold",fontSize:"14px"},children:"End Date:"}),e.jsx("input",{type:"date",value:I,onChange:s=>pe(s.target.value),style:{padding:"8px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px"}})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"15px"},children:e.jsx(m,{variant:"contained",color:"primary",onClick:ke,style:{padding:"10px 20px",fontWeight:"bold",borderRadius:"6px",backgroundColor:"#007bff",color:"#fff"},children:"Download Data"})})]}),e.jsx(Re,{component:Me,style:{marginTop:"20px"},children:e.jsxs(Ue,{children:[e.jsx(Ae,{children:e.jsxs(ee,{style:{fontWeight:"bold",backgroundColor:"#FFF9C4"},children:[e.jsx(d,{children:"S.No"}),e.jsx(d,{children:"Employee Name"}),e.jsx(d,{children:"Leads Name"}),e.jsx(d,{children:"Leads Mobile"}),e.jsx(d,{children:"Leads Email"}),e.jsx(d,{children:"Leads Company"}),e.jsx(d,{children:"State"}),e.jsx(d,{children:"City"}),e.jsx(d,{children:"Reminder Date"}),e.jsx(d,{children:"Action"})]})}),e.jsx(Oe,{children:_e.map((s,t)=>e.jsxs(ee,{children:[e.jsx(d,{children:t+1}),e.jsx(d,{children:s.emp_name}),e.jsx(d,{children:s.leads_name}),e.jsx(d,{children:s.leads_mobile}),e.jsx(d,{children:s.leads_email}),e.jsx(d,{children:s.leads_company}),e.jsx(d,{children:s.leads_state}),e.jsx(d,{children:s.leads_city}),e.jsx(d,{style:{color:S(s.reminder_date).isSame(S(),"day")?"red":"black"},children:S(s.reminder_date).format("YYYY-MM-DD")}),e.jsxs(d,{children:[e.jsx(m,{variant:"outlined",onClick:()=>De("quotation",s.follow_id),children:"Quotation"}),e.jsx(m,{onClick:()=>be(s.follow_id),children:"Edit"}),e.jsx(m,{variant:"outlined",onClick:()=>we(s.follow_id),children:"Remove"})]})]},t))})]})}),e.jsx(n,{container:!0,spacing:2,display:"flex",justifyContent:"center",className:"mt-4",children:e.jsx(Ie,{spacing:2,children:e.jsx(He,{count:Math.ceil(c.length/p),page:o,onChange:(s,t)=>x(t),size:"small"})})}),e.jsx($e,{open:ue,autoHideDuration:3e3,onClose:K,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Be,{onClose:K,severity:xe,sx:{width:"100%"},children:he})}),e.jsxs(T,{open:H,onClose:()=>k(!1),maxWidth:"md",children:[e.jsx(F,{children:e.jsx(Qe,{data:re,onClose:()=>k(!1)})}),e.jsx(E,{children:e.jsx(m,{onClick:()=>k(!1),children:"Close"})})]}),e.jsxs(T,{open:X,onClose:()=>W(!1),maxWidth:"md",children:[e.jsx(F,{children:e.jsx(ze,{data:Z,onSuccess:ve})}),e.jsx(E,{children:e.jsx(m,{onClick:()=>W(!1),children:"Close"})})]}),e.jsxs(T,{open:ie,onClose:()=>R(!1),maxWidth:"md",children:[e.jsx(Ve,{children:"Edit"}),e.jsx(F,{children:e.jsx(Xe,{data:de,onClose:()=>R(!1)})}),e.jsx(E,{children:e.jsx(m,{onClick:()=>R(!1),children:"Close"})})]}),e.jsxs(T,{open:oe,onClose:()=>M(!1),maxWidth:"md",children:[e.jsx(F,{children:e.jsx(Ge,{data:ce,onClose:()=>M(!1)})}),e.jsx(E,{children:e.jsx(m,{onClick:()=>M(!1),children:"Close"})})]})]})};export{ns as default};
